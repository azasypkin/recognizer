{"version":3,"file":"app.js","sources":["app.js","defer.js","video-manager.js","in-memory-storage.js","session-store.js","recognizers/text-recognizer.js","recognizers/barcode-recognizer.js","thing-recognizer.js","speech-synthesizer.js","describers/unknown-thing-describer.js","describers/nutrition-facts-describer.js","describers/barcode-describer.js","thing-describer.js","local-storage.js","painter.js"],"sourcesContent":["import Defer from './defer';\nimport VideoManager from './video-manager';\nimport ThingRecognizer from './thing-recognizer';\nimport ThingDescriber from './thing-describer';\nimport LocalStorage from './local-storage';\nimport InMemoryStorage from './in-memory-storage';\nimport SessionStore from './session-store';\nimport Painter from './painter';\n\nconst sampleActions = Object.freeze({\n  RECOGNIZE: 'RECOGNIZE',\n  REPEAT: 'REPEAT',\n  ROTATE: 'ROTATE'\n});\n\nconst canPlayDefer = new Defer();\nconst videoManager = new VideoManager();\nconst thingDescriber = new ThingDescriber();\nconst thingRecognizer = new ThingRecognizer();\nconst storage = LocalStorage.isSupported() ?\n  new LocalStorage() : new InMemoryStorage();\n\nconst samples = new Map();\n\nconst sampleIds = new Uint32Array(100);\nwindow.crypto.getRandomValues(sampleIds);\nlet currentSampleIndex = 0;\n\nconst apiKeyComponent = document.querySelector('.access__api-key');\n\napiKeyComponent.addEventListener('change', () => {\n  storage.set('access', 'api-key', apiKeyComponent.value);\n  SessionStore.set('ms-api-key', apiKeyComponent.value);\n});\n\nstorage.getByKey('access', 'api-key').catch((e) => {\n  console.warn('Could not retrieve API key from the storage', e);\n  return '';\n}).then((apiKey) => {\n  apiKeyComponent.value = apiKey;\n  SessionStore.set('ms-api-key', apiKey);\n});\n\nconst samplesListComponent = document.querySelector('.samples-list');\nconst blobRendererComponent = document.querySelector('.blob__renderer');\nconst blobLoaderComponent = document.querySelector('.blob__loader');\n\nsamplesListComponent.addEventListener('click', (e) => {\n  if (!apiKeyComponent.value) {\n    alert('Please provide Microsoft Vision API key.');\n    return;\n  }\n\n  const sampleId = e.target.dataset.sampleId;\n  if (e.target.nodeName.toUpperCase() !== 'BUTTON' || !sampleId) {\n    return;\n  }\n\n  const sample = samples.get(Number.parseInt(sampleId));\n  const buttonKind = e.target.dataset.kind;\n\n  if (buttonKind === sampleActions.RECOGNIZE) {\n    thingRecognizer.recognize(sample.image).then((textMetadata) => {\n      console.log('Success: %o', textMetadata);\n\n      sample.text = textMetadata;\n      samples.set(sample.id, sample);\n\n      const container = document.getElementById(sample.id);\n      container.classList.add('sample__container--recognized');\n\n      return getSampleCanvas(sample).then((textCanvas) => {\n        thingDescriber.describe(textMetadata, textCanvas);\n\n        blobRendererComponent.toBlob((imageBlob) => {\n          document.getElementById(sample.id).querySelector('img').src =\n            window.URL.createObjectURL(imageBlob);\n        });\n      });\n    }).catch((err) => {\n      console.error('Failure %o', err);\n    });\n  } else if (buttonKind === sampleActions.REPEAT) {\n    thingDescriber.describe(sample.text);\n  }\n});\n\nconst videoPreviewComponent = document.querySelector('.video__preview');\n\nconst context = blobRendererComponent.getContext('2d');\ncontext.fillStyle = '#aaa';\ncontext.fillRect(\n    0,\n    0,\n    blobRendererComponent.width,\n    blobRendererComponent.height\n);\n\nvideoManager.getMediaStream().then((stream) => {\n  videoPreviewComponent.src = window.URL.createObjectURL(stream);\n\n  videoPreviewComponent.addEventListener('loadedmetadata', () => {\n    videoPreviewComponent.play();\n\n    canPlayDefer.resolve({\n      width: videoPreviewComponent.videoWidth,\n      height: videoPreviewComponent.videoHeight\n    });\n  }, false);\n}).catch((err) => {\n  canPlayDefer.reject(err);\n});\n\nfunction addSample(sampleBlob) {\n  const sampleId = sampleIds[currentSampleIndex++];\n\n  const sampleContainer = document.createElement('div');\n  sampleContainer.classList = 'sample__container';\n  sampleContainer.id = sampleId;\n\n  const samplePreview = document.createElement('img');\n  samplePreview.classList = 'sample__preview';\n  samplePreview.src = window.URL.createObjectURL(sampleBlob);\n\n  const recognizeButton = document.createElement('button');\n  recognizeButton.type = 'button';\n  recognizeButton.textContent = 'Recognize';\n  recognizeButton.classList = 'sample__recognize-button action-button';\n  recognizeButton.dataset.sampleId = sampleId;\n  recognizeButton.dataset.kind = sampleActions.RECOGNIZE;\n\n  const repeatButton = document.createElement('button');\n  repeatButton.type = 'button';\n  repeatButton.textContent = 'Repeat text';\n  repeatButton.classList = 'sample__repeat-button action-button';\n  repeatButton.dataset.sampleId = sampleId;\n  repeatButton.dataset.kind = sampleActions.REPEAT;\n\n  sampleContainer.appendChild(samplePreview);\n  sampleContainer.appendChild(recognizeButton);\n  sampleContainer.appendChild(repeatButton);\n\n  samplesListComponent.appendChild(sampleContainer);\n\n  samples.set(sampleId, { id: sampleId, image: sampleBlob, text: null });\n}\n\nfunction getSampleCanvas(sample) {\n  const defer = new Defer();\n\n  blobLoaderComponent.src = window.URL.createObjectURL(sample.image);\n\n  blobLoaderComponent.onload = () => {\n    const canvasContext = blobRendererComponent.getContext('2d');\n\n    canvasContext.clearRect(\n      0, 0, Number(blobRendererComponent.getAttribute('width')),\n      Number(blobRendererComponent.getAttribute('height'))\n    );\n\n    blobRendererComponent.setAttribute('width', blobLoaderComponent.width);\n    blobRendererComponent.setAttribute('height', blobLoaderComponent.height);\n\n    canvasContext.drawImage(\n      blobLoaderComponent, 0, 0, blobLoaderComponent.width,\n      blobLoaderComponent.height\n    );\n\n    defer.resolve({\n      context: canvasContext,\n      width: blobLoaderComponent.width,\n      height: blobLoaderComponent.height\n    });\n  };\n\n  blobLoaderComponent.onerror = (e) => defer.reject(e);\n\n  return defer.promise;\n}\n\n/** Sample Camera provider **/\n\nconst shotButton = document.querySelector('.video__shot-button');\nshotButton.setAttribute('disabled', 'disabled');\nshotButton.addEventListener('click', () => {\n  const width = videoPreviewComponent.clientWidth;\n  const height = videoPreviewComponent.clientHeight;\n\n  blobRendererComponent.setAttribute('width', width);\n  blobRendererComponent.setAttribute('height', height);\n\n  blobRendererComponent.getContext('2d').drawImage(\n    videoPreviewComponent, 0, 0, Number(width), Number(height)\n  );\n\n  blobRendererComponent.toBlob((imageBlob) => {\n    addSample(imageBlob);\n  });\n});\n\ncanPlayDefer.promise.then(() => {\n  shotButton.removeAttribute('disabled');\n});\n\n/** End of Sample Camera provider **/\n\n\n/** Sample URL provider **/\nconst urlProviderURL = document.querySelector('.sample-url-provider__url');\nconst urlProviderSubmit = document.querySelector(\n  '.sample-url-provider__submit'\n);\n\nfunction addSampleFromURL(url) {\n  return fetch(url).catch((e) => {\n    console.warn('Can not load image directly, trying through the proxy: ', e);\n\n    const proxyURL = `https://recognizer-ocr-proxy.herokuapp.com/?${url}`;\n    const headers = new Headers();\n    headers.append('Target-URL', url);\n\n    return fetch(proxyURL, { headers });\n  }).then((response) => {\n    return response.blob();\n  }).then((blob) => {\n    addSample(blob);\n  }).catch((e) => {\n    console.error('Failed to add sample from URL: ', e);\n    alert('Failed to add sample! See log for more details...');\n  });\n}\n\nurlProviderSubmit.addEventListener('click', () => {\n  const sampleURL = urlProviderURL.value;\n  if (!sampleURL) {\n    alert('Please provide a valid image URL!');\n    return;\n  }\n\n  addSampleFromURL(sampleURL);\n});\n\n/** End of Sample URL provider **/\n\n\n/** Sample Local File provider **/\n\nconst localFileProviderPath = document.querySelector(\n  '.local-file-provider__path'\n);\n\nconst localFileProviderUpload = document.querySelector(\n  '.local-file-provider__upload'\n);\n\nlocalFileProviderPath.addEventListener('change', (e) => {\n  for (const file of e.target.files) {\n    addSample(file);\n  }\n});\n\nlocalFileProviderUpload.addEventListener('click', () => {\n  localFileProviderPath.click();\n});\n\n/** End of Sample URL provider **/\n\n\n/** Manual Sample provider **/\nconst manualSampleCanvas = document.querySelector(\n  '.manual-sample-provider__canvas'\n);\n\nconst manualSampleColorPicker = document.querySelector(\n  '.manual-sample-provider__color-picker'\n);\n\nconst manualSampleWidth = document.querySelector(\n  '.manual-sample-provider__width'\n);\n\nconst manualSampleClearButton = document.querySelector(\n  '.manual-sample-provider__clear-button'\n);\n\nconst manualSampleSubmit = document.querySelector(\n  '.manual-sample-provider__submit'\n);\n\nconst painter = new Painter(manualSampleCanvas);\n\nmanualSampleColorPicker.addEventListener('change', () => {\n  painter.setStyle(\n    manualSampleColorPicker.value,\n    Number(manualSampleWidth.value)\n  );\n});\n\nmanualSampleWidth.addEventListener('change', () => {\n  painter.setStyle(\n    manualSampleColorPicker.value,\n    Number(manualSampleWidth.value)\n  );\n});\n\nmanualSampleClearButton.addEventListener('click', () => {\n  painter.clear();\n});\n\nmanualSampleSubmit.addEventListener('click', () => {\n  manualSampleCanvas.toBlob((imageBlob) => addSample(imageBlob));\n});\n\n/** End of Manual Sample provider **/\n\nfunction addSampleFromHash() {\n  if (!location.hash || location.hash.length < 2) {\n    return;\n  }\n\n  addSampleFromURL(location.hash.slice(1).trim());\n}\n\nwindow.addEventListener('hashchange', () => {\n  addSampleFromHash();\n});\n\naddSampleFromHash();","'use strict';\n\nconst p = Object.freeze({\n  promise: Symbol('promise'),\n  resolve: Symbol('resolve'),\n  reject: Symbol('reject'),\n});\n\n/**\n * Instance of the Defer class is just a handy wrapper around native Promise\n * object intended to provide dedicated 'resolve' and 'reject' methods.\n */\nexport default class Defer {\n  constructor() {\n    this[p.promise] = new Promise((resolve, reject) => {\n      this[p.resolve] = resolve;\n      this[p.reject] = reject;\n    });\n\n    Object.freeze(this);\n  }\n\n  /**\n   * Actual promise instance.\n   *\n   * @return {Promise}\n   */\n  get promise() {\n    return this[p.promise];\n  }\n\n  /**\n   * Resolves promise with the specified value.\n   *\n   * @param {*=} value Optional value to resolve promise with.\n   */\n  resolve(value) {\n    this[p.resolve](value);\n  }\n\n  /**\n   * Rejects promise with the specified error.\n   *\n   * @param {*=} error Error to reject promise with.\n   */\n  reject(error) {\n    this[p.reject](error);\n  }\n}\n","const p = Object.freeze({\n  getUserMediaOld: Symbol('getUserMediaOld')\n});\n\nexport default class VideoManager {\n  getMediaStream(video = true, audio = false) {\n    // Older browsers might not implement mediaDevices at all, so we set an\n    // empty object first.\n    if(navigator.mediaDevices === undefined) {\n      navigator.mediaDevices = {};\n    }\n\n    // Some browsers partially implement mediaDevices. We can't just assign an\n    // object with getUserMedia as it would overwrite existing properties. Here,\n    // we will just add the getUserMedia property if it's missing.\n    if(navigator.mediaDevices.getUserMedia === undefined) {\n      navigator.mediaDevices.getUserMedia = this[p.getUserMediaOld];\n    }\n\n    return navigator.mediaDevices.getUserMedia({ audio, video }).then(\n      (stream) => {\n        console.log('[VideoManager]: Media stream is available.');\n\n        return stream;\n      }\n    ).catch((err) => {\n      console.error('[VideoManager]: Media stream is not available.', err);\n\n      throw err;\n    });\n  }\n\n  [p.getUserMediaOld](constraints) {\n    const getUserMedia = (navigator.getUserMedia ||\n      navigator.webkitGetUserMedia || navigator.mozGetUserMedia);\n\n    // Some browsers just don't implement it - return a rejected promise with an\n    // error to keep a consistent interface.\n    if(!getUserMedia) {\n      return Promise.reject(\n        new Error('getUserMedia is not implemented in this browser')\n      );\n    }\n\n    return new Promise((resolve, reject) => {\n      getUserMedia.call(navigator, constraints, resolve, reject);\n    });\n  }\n}\n","'use strict';\n\nconst p = Object.freeze({ db: Symbol('db') });\n\nexport default class InMemoryStorage {\n  constructor() {\n    this[p.db] = new Map();\n  }\n\n  /**\n   * Gets all items from the specified store.\n   *\n   * @param {string} storeKey Key of the store to retrieve all items from.\n   * @return {Promise.<Array>}\n   */\n  getAll(storeKey) {\n    const store = this[p.db].get(storeKey);\n\n    return Promise.resolve(store ? Array.from(store.values()) : []);\n  }\n\n  /**\n   * Returns single item from the specified store by item's key.\n   *\n   * @param {string} storeKey Key of the store to retrieve item from.\n   * @param {string} itemKey Key of the item to retrieve.\n   * @return {*}\n   */\n  getByKey(storeKey, itemKey) {\n    const store = this[p.db].get(storeKey);\n\n    if (!store || !store.has(itemKey)) {\n      return Promise.reject(\n        new Error(`There is no item (${itemKey}) in the store (${storeKey}).`)\n      );\n    }\n\n    return Promise.resolve(store.get(itemKey));\n  }\n\n  /**\n   * Adds/updates item to/in specified store.\n   *\n   * @param {string} storeKey Key of the store to save item to.\n   * @param {string} itemKey Key of the item to save.\n   * @param {*} itemData Item data to save.\n   * @return {Promise}\n   */\n  set(storeKey, itemKey, itemData) {\n    let store = this[p.db].get(storeKey);\n\n    if (!store) {\n      this[p.db].set(storeKey, (store = new Map()));\n    }\n\n    store.set(itemKey, itemData);\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Removes item from the specified store.\n   *\n   * @param {string} storeKey Key of the store to remove item from.\n   * @param {string} itemKey Key of the item to remove.\n   * @return {Promise}\n   */\n  remove(storeKey, itemKey) {\n    const store = this[p.db].get(storeKey);\n\n    if (store) {\n      store.delete(itemKey);\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Entirely clears specified store.\n   *\n   * @param {string} storeKey Key of the store to clear.\n   * @return {Promise}\n   */\n  clear(storeKey) {\n    const store = this[p.db].get(storeKey);\n\n    if (store) {\n      store.clear();\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Clears all available stores.\n   *\n   * @return {Promise}\n   */\n  clearAll() {\n    this[p.db].clear();\n    return Promise.resolve();\n  }\n}\n","'use strict';\n\nimport InMemoryStorage from './in-memory-storage';\n\nconst STORE_KEY = 'session';\nconst storage = new InMemoryStorage();\n\n/**\n * Instance of the Defer class is just a handy wrapper around native Promise\n * object intended to provide dedicated 'resolve' and 'reject' methods.\n */\nexport default class SessionStore {\n  /**\n   * Returns single item from the session store.\n   *\n   * @param {string} itemKey Key of the item to retrieve.\n   * @return {*}\n   */\n  static get(itemKey) {\n    return storage.getByKey(STORE_KEY, itemKey).catch(() => {\n      throw new Error(`There is no item (${itemKey}) in the session store.`);\n    });\n  }\n\n  /**\n   * Adds/updates item to/in session store.\n   *\n   * @param {string} itemKey Key of the item to save.\n   * @param {*} itemData Item data to save.\n   * @return {Promise}\n   */\n  static set(itemKey, itemData) {\n    return storage.set(STORE_KEY, itemKey, itemData);\n  }\n\n  /**\n   * Removes item from the session store.\n   *\n   * @param {string} itemKey Key of the item to remove.\n   * @return {Promise}\n   */\n  static remove(itemKey) {\n    return storage.remove(STORE_KEY, itemKey);\n  }\n}\n","'use strict';\n\nimport SessionStore from '../session-store';\n\nconst p = Object.freeze({\n  apiURL: Symbol('apiURL')\n});\n\nexport default class TextRecognizer {\n  constructor(language = 'unk', detectOrientation = true) {\n    this[p.apiURL] = 'https://api.projectoxford.ai/vision/v1.0/ocr?' +\n      `language=${language}&detectOrientation=${detectOrientation}`;\n  }\n\n  recognize(imageBlob) {\n    return SessionStore.get('ms-api-key').then((apiKey) => {\n      const headers = new Headers();\n      headers.append('Ocp-Apim-Subscription-Key', apiKey);\n\n      const formData = new FormData();\n      formData.append('image', imageBlob, 'image.png');\n\n      return fetch(this[p.apiURL], {\n        method: 'POST',\n        headers,\n        body: formData\n      }).then((response) => response.json());\n    });\n  }\n}\n","/* global Quagga */\n\n/*const config = Object.freeze({\n  inputStream: {\n  name: 'Test',\n    type: 'ImageStream',\n    length: 10,\n    size: 800\n  },\n  locator: {\n    patchSize: 'medium',\n      halfSample: true\n  }\n});*/\n\nexport default class BarcodeRecognizer {\n  constructor() {\n  }\n\n  recognize(imageBlob) {\n    return new Promise((resolve, reject) => {\n      Quagga.decodeSingle({\n        src: window.URL.createObjectURL(imageBlob),\n        decoder: {\n          readers: [\n            'code_128_reader',\n            'ean_reader',\n            'ean_8_reader',\n            'code_39_reader',\n            'code_39_vin_reader',\n            'codabar_reader',\n            'upc_reader',\n            'upc_e_reader',\n            'i2of5_reader'\n          ],\n        }\n      }, (result) => {\n        console.log('Quagga: ', result);\n        if (result) {\n          resolve(result);\n        } else {\n          reject();\n        }\n      });\n    });\n  }\n}\n","import TextRecognizer from './recognizers/text-recognizer';\nimport BarcodeRecognizer from './recognizers/barcode-recognizer';\n\nconst p = Object.freeze({\n  synthesizer: Symbol('synthesizer'),\n  recognizers: Symbol('recognizers'),\n\n  recognize: Symbol('recognize')\n});\n\nexport default class ThingRecognizer {\n  constructor() {\n    this[p.recognizers] = [new BarcodeRecognizer(), new TextRecognizer()];\n  }\n\n  recognize(imageBlob) {\n    return this[p.recognize](imageBlob);\n  }\n\n  [p.recognize](imageBlob, recognizerIndex = 0) {\n    const recognizers = this[p.recognizers];\n    if (recognizerIndex >= recognizers.length) {\n      return Promise.reject();\n    }\n\n    return recognizers[recognizerIndex].recognize(imageBlob).catch((e) => {\n      console.warn('Recognizer did not recognize image', e);\n      return this[p.recognize](imageBlob, recognizerIndex + 1);\n    });\n  }\n}\n","const p = Object.freeze({\n  pitch: Symbol('pitch'),\n  rate: Symbol('rate'),\n  synthesis: Symbol('synthesis'),\n\n  // Methods\n  getPreferredVoice: Symbol('getPreferredVoice'),\n});\n\nexport default class SpeechSynthesizer {\n  constructor(pitch, rate) {\n    this[p.pitch] = pitch;\n    this[p.rate] = rate;\n    this[p.synthesis] = window.speechSynthesis || null;\n\n    Object.seal(this);\n  }\n\n  /**\n   * Speak a text aloud.\n   *\n   * @param {string} text\n   * @param {string} language\n   */\n  speak(text = '', language = 'en') {\n    const synthesis = this[p.synthesis];\n    if (!text || !synthesis) {\n      return;\n    }\n\n    const utterance = new SpeechSynthesisUtterance(text);\n\n    const voice = this[p.getPreferredVoice](language);\n    if (voice) {\n      utterance.voice = voice;\n    }\n\n    utterance.lang = language;\n    utterance.pitch = this[p.pitch];\n    utterance.rate = this[p.rate];\n\n    synthesis.speak(utterance);\n  }\n\n  /**\n   * From all the voices available, set the default language to English with a\n   * female voice if available.\n   *\n   * @param {string} language\n   *\n   * @returns {Object}\n   */\n  [p.getPreferredVoice](language) {\n    const allVoices = this[p.synthesis].getVoices();\n    if (!allVoices.length) {\n      return null;\n    }\n\n    const voices = allVoices.filter((voice) => voice.lang.startsWith(language));\n    const femaleVoices = voices.filter(\n      (voice) => voice.name.includes('Female')\n    );\n\n    if (femaleVoices.length) {\n      return femaleVoices[0];\n    }\n\n    if (voices.length) {\n      return voices[0];\n    }\n\n    // If we can't find any voice for the language let's fallback to English.\n    if (!language.startsWith('en')) {\n      return this[p.getPreferredVoice]('en');\n    }\n\n    return null;\n  }\n}\n","const LANGUAGES = new Map([\n  ['unk', 'Unknown'],\n  ['ar', 'Arabic'],\n  ['zh-Hans', 'Simplified Chinese'],\n  ['zh-Hant', 'Traditional Chinese'],\n  ['cs', 'Czech'],\n  ['da', 'Danish'],\n  ['nl', 'Dutch'],\n  ['en', 'English'],\n  ['fi', 'Finnish'],\n  ['fr', 'French'],\n  ['de', 'German'],\n  ['el', 'Greek'],\n  ['hu', 'Hungarian'],\n  ['it', 'Italian'],\n  ['ja', 'Japanese'],\n  ['ko', 'Korean'],\n  ['nb', 'Norwegian'],\n  ['pl', 'Polish'],\n  ['pt', 'Portuguese'],\n  ['ru', 'Russian'],\n  ['es', 'Spanish'],\n  ['sv', 'Swedish'],\n  ['tr', 'Turkish']\n]);\n\nconst orientation = Object.freeze({\n  LEFT: 'Left',\n  RIGHT: 'Right',\n  UP: 'Up',\n  DOWN: 'Down'\n});\n\nconst p = Object.freeze({\n  synthesizer: Symbol('synthesizer')\n});\n\nexport default class UnknownThingDescriber {\n  constructor(synthesizer) {\n    if (!synthesizer) {\n      throw new Error('Speech Synthesizer should be provided!');\n    }\n\n    this[p.synthesizer] = synthesizer;\n  }\n\n  canDescribe(textMetadata) {\n    const numberOfTextRegions = textMetadata.regions ?\n      textMetadata.regions.length : 0;\n    if (numberOfTextRegions === 0) {\n      return false;\n    }\n\n    return true;\n  }\n\n  describe(textMetadata, textCanvas) {\n    const numberOfTextRegions = textMetadata.regions ?\n      textMetadata.regions.length : 0;\n    if (numberOfTextRegions === 0) {\n      throw new Error('Text metadata is not provided!');\n    }\n\n    const synthesizer = this[p.synthesizer];\n    let horizontalDimension, verticalDimension;\n\n    if (textCanvas) {\n      textCanvas.context.translate(textCanvas.width / 2, textCanvas.height / 2);\n\n      horizontalDimension = textCanvas.width;\n      verticalDimension = textCanvas.height;\n\n      let textAngle = textMetadata.textAngle;\n      if (textMetadata.orientation === orientation.LEFT) {\n        textAngle -= 90;\n        horizontalDimension = textCanvas.height;\n        verticalDimension = textCanvas.width;\n      } else if (textMetadata.orientation === orientation.RIGHT) {\n        textAngle += 90;\n        horizontalDimension = textCanvas.height;\n        verticalDimension = textCanvas.width;\n      } else if (textMetadata.orientation === orientation.DOWN) {\n        textAngle += 180;\n      }\n\n      textCanvas.context.rotate(textAngle * Math.PI / 180);\n      textCanvas.context.lineWidth = 3;\n      textCanvas.context.strokeStyle = '#FF0000';\n    }\n\n    if (numberOfTextRegions === 1) {\n      synthesizer.speak('I see just one region of text.');\n    } else {\n      synthesizer.speak(`I see ${numberOfTextRegions} regions of text.`);\n    }\n\n    const language = textMetadata.language;\n\n    if (!language || language === 'unk') {\n      synthesizer.speak('I can not recognize the language.');\n    } else {\n      synthesizer.speak(\n        `I think this is ${LANGUAGES.get(language)} language.`\n      );\n    }\n\n    if (textMetadata.textAngle === 0) {\n      synthesizer.speak('Text is perfectly aligned.');\n    } else if (textMetadata.textAngle < 10) {\n      synthesizer.speak('Text is almost perfectly aligned.');\n    } else {\n      synthesizer.speak('Text is skewed.');\n    }\n\n    for (let i = 0; i < numberOfTextRegions; i++) {\n      const region = textMetadata.regions[i];\n      synthesizer.speak(\n        `Region number ${i + 1} consists of ` +\n        `${region.lines.length} lines of text.`\n      );\n\n      for (let l = 0; l < region.lines.length; l++) {\n        const line = region.lines[l];\n        synthesizer.speak(\n          `Let me read words from the line number ${l + 1}:`\n        );\n\n        const sentence = line.words.reduce((sentence, word) => {\n          const boundingBox = word.boundingBox.split(',').map((dimension) => {\n            return Number(dimension.trim());\n          });\n\n          if (textCanvas) {\n            textCanvas.context.rect(\n              boundingBox[0] - horizontalDimension / 2,\n              boundingBox[1] - verticalDimension / 2,\n              boundingBox[2], boundingBox[3]\n            );\n\n            textCanvas.context.stroke();\n          }\n\n          return `${sentence} ${word.text}`;\n        }, '');\n\n        synthesizer.speak(sentence, language);\n      }\n    }\n  }\n}","const p = Object.freeze({\n  synthesizer: Symbol('synthesizer')\n});\n\n// List of the keywords that should be located in the same line with a\n// confidence level.\nconst patterns = [\n  /nutr(.)+(?=fact)/i,\n  /servi(.)+(?=size)(.)+(?=cup)/i,\n  /amoun(.)+(?=servi)/i,\n  /calori(.)+(?=fro)(.)+(?=fat)/i,\n  /satura(.)+(?=fat)/i,\n  /trans(.)+(?=fat)/i,\n];\n\nconst generalPattern = new RegExp('(vitamin|iron|protein|sodium|fat|sugar|' +\n    'fiber|calori|diet|choleste|carbo|mg|nutri|daily|calcium|potassi)', 'g');\n\nexport default class NutritionFactsDescriber {\n  constructor(synthesizer) {\n    if (!synthesizer) {\n      throw new Error('Speech Synthesizer should be provided!');\n    }\n\n    this[p.synthesizer] = synthesizer;\n  }\n\n  canDescribe(textMetadata) {\n    const numberOfTextRegions = textMetadata.regions ?\n      textMetadata.regions.length : 0;\n    if (numberOfTextRegions === 0) {\n      return false;\n    }\n\n    let fullText = '';\n    for (const region of textMetadata.regions) {\n      for (const line of region.lines) {\n        const sentence = line.words.reduce((sentence, word) => {\n          return `${sentence} ${word.text}`;\n        }, '');\n\n        for (const pattern of patterns) {\n          if (pattern.test(sentence)) {\n            return true;\n          }\n        }\n\n        fullText += sentence;\n      }\n    }\n\n    const generalMatches = fullText.match(generalPattern);\n\n    return generalMatches && generalMatches.length > 8;\n  }\n\n  describe(textMetadata, textCanvas) {\n    const numberOfTextRegions = textMetadata.regions.length;\n    if (numberOfTextRegions === 0) {\n      throw new Error('Text metadata is not provided!');\n    }\n\n    const synthesizer = this[p.synthesizer];\n    synthesizer.speak('I think this is a nutrition facts label.');\n\n    if (textCanvas) {\n      textCanvas.context.lineWidth = 3;\n      textCanvas.context.strokeStyle = '#FF0000';\n    }\n  }\n}","const p = Object.freeze({\n  synthesizer: Symbol('synthesizer')\n});\n\nexport default class BarcodeDescriber {\n  constructor(synthesizer) {\n    if (!synthesizer) {\n      throw new Error('Speech Synthesizer should be provided!');\n    }\n\n    this[p.synthesizer] = synthesizer;\n  }\n\n  canDescribe(textMetadata) {\n    if (textMetadata.codeResult ||\n      (textMetadata.boxes && textMetadata.boxes.length > 0)) {\n      return true;\n    }\n  }\n\n  describe(textMetadata, textCanvas) {\n    const synthesizer = this[p.synthesizer];\n    synthesizer.speak('I see the barcode on this picture.');\n\n    if (!textMetadata.codeResult || !textMetadata.codeResult.code) {\n      synthesizer.speak('But I could not recognize the numbers on it.');\n      synthesizer.speak('Please try to make better picture.');\n    } else {\n      if (textMetadata.codeResult.format) {\n        let format = textMetadata.codeResult.format.toLowerCase().replace(\n          '_', ' '\n        );\n\n        format = format.replace('ean', 'International Article Number (or EAN)');\n        format = format.replace('upc', 'Universal Product Code (or UPC)');\n\n        synthesizer.speak(`Barcode format is ${format}`);\n      }\n\n      const number = Array.from(textMetadata.codeResult.code).reduce(\n        (result, digit) => `${result} ${digit}`, ''\n      );\n\n      synthesizer.speak(`Barcode number is ${number}`);\n    }\n\n    if (textCanvas) {\n      textCanvas.context.lineWidth = 3;\n      textCanvas.context.strokeStyle = '#FF0000';\n    }\n  }\n}","import SpeechSynthesizer from './speech-synthesizer';\nimport UnknownThingDescriber from './describers/unknown-thing-describer';\nimport NutritionFactsDescriber from './describers/nutrition-facts-describer';\nimport BarcodeDescriber from './describers/barcode-describer';\n\nconst p = Object.freeze({\n  synthesizer: Symbol('synthesizer'),\n  recognizers: Symbol('recognizers')\n});\n\nconst DEFAULT_VOICE_PITCH = 0.8;\nconst DEFAULT_VOICE_RATE = 0.9;\n\nexport default class ThingDescriber {\n  constructor(pitch = DEFAULT_VOICE_PITCH, rate = DEFAULT_VOICE_RATE) {\n    const synthesizer = this[p.synthesizer] =\n      new SpeechSynthesizer(pitch, rate);\n\n    this[p.recognizers] = [\n      new BarcodeDescriber(synthesizer),\n      new NutritionFactsDescriber(synthesizer),\n      new UnknownThingDescriber(synthesizer)\n    ];\n  }\n\n  describe(textMetadata, textCanvas) {\n    for (const describer of this[p.recognizers]) {\n      if (describer.canDescribe(textMetadata)) {\n        describer.describe(textMetadata, textCanvas);\n        return;\n      }\n    }\n\n    this[p.synthesizer].speak(\n      'Sorry! I do not recognize anything on this picture.'\n    );\n  }\n}\n","'use strict';\n\nexport default class LocalStorage {\n  static isSupported() {\n    try {\n      return !!self.localStorage && Number.isInteger(self.localStorage.length);\n    } catch(e) {\n      return false;\n    }\n  }\n\n  /**\n   * Gets all items from the specified store.\n   *\n   * @param {string} storeKey Key of the store to retrieve all items from.\n   * @return {Promise.<Array>}\n   */\n  getAll(storeKey) {\n    const serializedStore = localStorage.getItem(storeKey);\n\n    return Promise.resolve(\n      serializedStore ?\n        Array.from((new Map(JSON.parse(serializedStore))).values()) : []\n    );\n  }\n\n  /**\n   * Returns single item from the store by item's key.\n   *\n   * @param {string} storeKey Key of the store to retrieve item from.\n   * @param {string} itemKey Key of the item to retrieve.\n   * @return {*}\n   */\n  getByKey(storeKey, itemKey) {\n    const serializedStore = localStorage.getItem(storeKey);\n    const store = new Map(serializedStore ? JSON.parse(serializedStore) : []);\n\n    if (!store.has(itemKey)) {\n      return Promise.reject(\n        new Error(`There is no item (${itemKey}) in the store (${storeKey}).`)\n      );\n    }\n\n    return Promise.resolve(store.get(itemKey));\n  }\n\n  /**\n   * Adds/updates item to/in specified store.\n   *\n   * @param {string} storeKey Key of the store to save item to.\n   * @param {string} itemKey Key of the item to save.\n   * @param {*} itemData Item data to save.\n   * @return {Promise}\n   */\n  set(storeKey, itemKey, itemData) {\n    const serializedStore = localStorage.getItem(storeKey);\n\n    const store = new Map(serializedStore ? JSON.parse(serializedStore) : []);\n    store.set(itemKey, itemData);\n\n    localStorage.setItem(storeKey, JSON.stringify(Array.from(store.entries())));\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Removes item from the specified store.\n   *\n   * @param {string} storeKey Key of the store to remove item from.\n   * @param {string} itemKey Key of the item to remove.\n   * @return {Promise}\n   */\n  remove(storeKey, itemKey) {\n    const serializedStore = localStorage.getItem(storeKey);\n\n    if (serializedStore) {\n      const store = new Map(JSON.parse(serializedStore));\n      store.delete(itemKey);\n\n      localStorage.setItem(\n        storeKey, JSON.stringify(Array.from(store.entries()))\n      );\n    }\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Entirely clears specified store.\n   *\n   * @param {string} storeKey Key of the store to clear.\n   * @return {Promise}\n   */\n  clear(storeKey) {\n    localStorage.removeItem(storeKey);\n\n    return Promise.resolve();\n  }\n\n  /**\n   * Clears all available stores.\n   *\n   * @return {Promise}\n   */\n  clearAll() {\n    localStorage.clear();\n    return Promise.resolve();\n  }\n}\n","'use strict';\n\nconst p = Object.freeze({\n  canvas: Symbol('canvas'),\n  context: Symbol('context'),\n  width: Symbol('width'),\n  height: Symbol('height'),\n  currentPoint: Symbol('currentPoint'),\n  previousPoint: Symbol('previousPoint'),\n  flag: Symbol('flag'),\n  styleColor: Symbol('styleColor'),\n  styleWidth: Symbol('styleWidth'),\n\n  // Methods.\n  findXY: Symbol('findXY'),\n  draw: Symbol('draw')\n});\n\n/**\n * Instance of the Defer class is just a handy wrapper around native Promise\n * object intended to provide dedicated 'resolve' and 'reject' methods.\n */\nexport default class Painter {\n  constructor(canvas) {\n    this[p.canvas] = canvas;\n    this[p.context] = canvas.getContext('2d');\n    this[p.width] = canvas.width;\n    this[p.height] = canvas.height;\n\n    this[p.styleColor] = '#000';\n    this[p.styleWidth] = 2;\n\n    this[p.currentPoint] = { x: 0, y: 0 };\n    this[p.previousPoint] = { x: 0, y: 0 };\n    this[p.flag] = false;\n\n    canvas.addEventListener('mousemove', (e) => this[p.findXY]('move', e));\n    canvas.addEventListener('mousedown', (e) => this[p.findXY]('down', e));\n    canvas.addEventListener('mouseup', (e) => this[p.findXY]('up', e));\n    canvas.addEventListener('mouseout', (e) => this[p.findXY]('out', e));\n\n    Object.seal(this);\n  }\n\n  setStyle(color, width) {\n    if (!color) {\n      throw new Error('Color should a valid non-empty HEX color string!');\n    }\n\n    if (!Number.isInteger(width) || width < 0) {\n      throw Error('Width should a valid positive integer!');\n    }\n\n    this[p.styleColor] = color;\n    this[p.styleWidth] = width;\n  }\n\n  clear() {\n    this[p.context].clearRect(0, 0, this[p.width], this[p.height]);\n  }\n\n  [p.findXY](res, e) {\n    //const canvas = this[p.canvas];\n\n    //let x, y;\n    /*if (e.layerX || e.layerX === 0) {\n      x = e.layerX;\n      y = e.layerY;\n    } else if (e.offsetX || e.offsetX === 0) {*/\n      const x = e.offsetX;\n      const y = e.offsetY;\n\n    //}\n\n    if (res === 'down') {\n      console.log(`e.offsetX: ${e.offsetX}, e.offsetY: ${e.offsetY}`);\n      this[p.previousPoint] = this[p.currentPoint];\n      this[p.currentPoint] = {x, y};\n      //  x: x, //e.clientX - canvas.offsetLeft,\n      //  y: y//e.clientY - canvas.offsetTop\n      //};\n\n      this[p.flag] = true;\n\n      const context = this[p.context];\n      context.beginPath();\n      context.fillStyle = this[p.styleColor];\n      context.fillRect(\n        this[p.currentPoint].x, this[p.currentPoint].y, this[p.styleWidth],\n        this[p.styleWidth]\n      );\n      context.closePath();\n    } else if (res === 'up' || res === 'out') {\n      this[p.flag] = false;\n    } else if (res === 'move' && this[p.flag]) {\n      this[p.previousPoint] = this[p.currentPoint];\n      this[p.currentPoint] = {x, y};\n      //  x: x,//e.clientX - canvas.offsetLeft,\n      //  y: y//e.clientY - canvas.offsetTop\n      // };\n\n      this[p.draw]();\n    }\n  }\n\n  [p.draw]() {\n    const context = this[p.context];\n\n    context.beginPath();\n    context.moveTo(this[p.previousPoint].x, this[p.previousPoint].y);\n    context.lineTo(this[p.currentPoint].x, this[p.currentPoint].y);\n    context.strokeStyle = this[p.styleColor];\n    context.lineWidth = this[p.styleWidth];\n    context.stroke();\n    context.closePath();\n  }\n}\n"],"names":["addSample","sampleBlob","sampleId","sampleIds","currentSampleIndex","sampleContainer","document","createElement","classList","id","samplePreview","src","window","URL","createObjectURL","recognizeButton","type","textContent","dataset","kind","sampleActions","RECOGNIZE","repeatButton","REPEAT","appendChild","set","image","text","getSampleCanvas","sample","defer","Defer","onload","canvasContext","blobRendererComponent","getContext","clearRect","Number","getAttribute","setAttribute","blobLoaderComponent","width","height","drawImage","resolve","onerror","e","reject","promise","addSampleFromURL","url","fetch","catch","warn","proxyURL","headers","Headers","append","then","response","blob","error","addSampleFromHash","location","hash","length","slice","trim","p","Object","freeze","Symbol","Promise","this","value","VideoManager","getMediaStream","video","audio","undefined","navigator","mediaDevices","getUserMedia","getUserMediaOld","stream","log","err","constraints","webkitGetUserMedia","mozGetUserMedia","call","Error","db","InMemoryStorage","Map","getAll","storeKey","store","get","Array","from","values","getByKey","itemKey","has","itemData","remove","delete","clear","clearAll","STORE_KEY","storage","SessionStore","TextRecognizer","language","detectOrientation","apiURL","recognize","imageBlob","apiKey","formData","FormData","_this","json","BarcodeRecognizer","decodeSingle","result","ThingRecognizer","recognizers","recognizerIndex","SpeechSynthesizer","pitch","rate","synthesis","speechSynthesis","seal","speak","utterance","SpeechSynthesisUtterance","voice","getPreferredVoice","lang","allVoices","getVoices","voices","filter","startsWith","femaleVoices","name","indexOf","LANGUAGES","orientation","UnknownThingDescriber","synthesizer","canDescribe","textMetadata","numberOfTextRegions","regions","describe","textCanvas","horizontalDimension","verticalDimension","context","translate","textAngle","LEFT","RIGHT","DOWN","rotate","Math","PI","lineWidth","strokeStyle","i","region","lines","l","line","sentence","words","reduce","word","boundingBox","split","map","dimension","rect","stroke","patterns","generalPattern","RegExp","NutritionFactsDescriber","fullText","pattern","test","generalMatches","match","BarcodeDescriber","codeResult","boxes","code","format","toLowerCase","replace","number","digit","DEFAULT_VOICE_PITCH","DEFAULT_VOICE_RATE","ThingDescriber","describer","LocalStorage","isSupported","self","localStorage","isInteger","serializedStore","getItem","JSON","parse","setItem","stringify","entries","removeItem","Painter","canvas","styleColor","styleWidth","currentPoint","x","y","previousPoint","flag","addEventListener","findXY","setStyle","color","res","offsetX","offsetY","beginPath","fillStyle","fillRect","closePath","draw","moveTo","lineTo","canPlayDefer","videoManager","thingDescriber","thingRecognizer","samples","Uint32Array","crypto","getRandomValues","apiKeyComponent","querySelector","samplesListComponent","target","nodeName","toUpperCase","parseInt","buttonKind","container","getElementById","add","toBlob","videoPreviewComponent","play","videoWidth","videoHeight","shotButton","clientWidth","clientHeight","removeAttribute","urlProviderURL","urlProviderSubmit","sampleURL","localFileProviderPath","localFileProviderUpload","file","files","click","manualSampleCanvas","manualSampleColorPicker","manualSampleWidth","manualSampleClearButton","manualSampleSubmit","painter"],"mappings":"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","sourceRoot":"/source/"}