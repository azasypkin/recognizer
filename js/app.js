function addSample(e){var t=sampleIds[currentSampleIndex++],o=document.createElement("div");o.classList="sample__container",o.id=t;var n=document.createElement("img");n.classList="sample__preview",n.src=window.URL.createObjectURL(e);var r=document.createElement("button");r.type="button",r.textContent="Recognize",r.classList="sample__recognize-button action-button",r.dataset.sampleId=t,r.dataset.kind=sampleActions.RECOGNIZE;var i=document.createElement("button");i.type="button",i.textContent="Repeat text",i.classList="sample__repeat-button action-button",i.dataset.sampleId=t,i.dataset.kind=sampleActions.REPEAT,o.appendChild(n),o.appendChild(r),o.appendChild(i),samplesListComponent.appendChild(o),samples.set(t,{id:t,image:e,text:null})}function outlineSampleWords(e){blobLoaderComponent.src=window.URL.createObjectURL(e.image),blobLoaderComponent.onload=function(){var t=blobRendererComponent.getContext("2d");t.clearRect(0,0,Number(blobRendererComponent.getAttribute("width")),Number(blobRendererComponent.getAttribute("height"))),blobRendererComponent.setAttribute("width",blobLoaderComponent.width),blobRendererComponent.setAttribute("height",blobLoaderComponent.height),t.drawImage(blobLoaderComponent,0,0,blobLoaderComponent.width,blobLoaderComponent.height),t.translate(blobLoaderComponent.width/2,blobLoaderComponent.height/2);var o=e.text.textAngle;e.text.orientation===orientation.LEFT?o-=90:e.text.orientation===orientation.RIGHT?o+=90:e.text.orientation===orientation.DOWN&&(o+=180),t.rotate(o*Math.PI/180);for(var n of e.text.regions)for(var r of n.lines)for(var i of r.words){var a=i.boundingBox.split(",").map(function(e){return Number(e.trim())});t.rect(a[0]-blobLoaderComponent.width/2,a[1]-blobLoaderComponent.height/2,a[2],a[3]),t.stroke()}blobRendererComponent.toBlob(function(t){document.getElementById(e.id).querySelector("img").src=window.URL.createObjectURL(t)})},document.body.appendChild(blobLoaderComponent)}function addSampleFromURL(e){return fetch(e).catch(function(t){console.warn("Can not load image directly, trying through the proxy: ",t);var o=`https://recognizer-ocr-proxy.herokuapp.com/?${e}`,n=new Headers;return n.append("Target-URL",e),fetch(o,{headers:n})}).then(function(e){return e.blob()}).then(function(e){addSample(e)}).catch(function(e){console.error("Failed to add sample from URL: ",e),alert("Failed to add sample! See log for more details...")})}function addSampleFromHash(){!location.hash||location.hash.length<2||addSampleFromURL(location.hash.slice(1).trim())}var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}(),p=Object.freeze({promise:Symbol("promise"),resolve:Symbol("resolve"),reject:Symbol("reject")}),Defer=function(){function e(){var t=this;classCallCheck(this,e),this[p.promise]=new Promise(function(e,o){t[p.resolve]=e,t[p.reject]=o}),Object.freeze(this)}return e.prototype.resolve=function(e){this[p.resolve](e)},e.prototype.reject=function(e){this[p.reject](e)},createClass(e,[{key:"promise",get:function(){return this[p.promise]}}]),e}(),p$1=Object.freeze({getUserMediaOld:Symbol("getUserMediaOld")}),VideoManager=function(){function e(){classCallCheck(this,e)}return e.prototype.getMediaStream=function(){var e=arguments.length<=0||void 0===arguments[0]||arguments[0],t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];return void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=this[p$1.getUserMediaOld]),navigator.mediaDevices.getUserMedia({audio:t,video:!!e&&{facingMode:{exact:"environment"}}}).then(function(e){return console.log("[VideoManager]: Media stream is available."),e}).catch(function(e){throw console.error("[VideoManager]: Media stream is not available.",e),e})},e.prototype[p$1.getUserMediaOld]=function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise(function(o,n){t.call(navigator,e,o,n)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))},e}(),p$2=Object.freeze({apiURL:Symbol("apiURL"),apiKey:Symbol("apiKey")}),TextRecognizer=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],o=arguments.length<=1||void 0===arguments[1]?"unk":arguments[1],n=arguments.length<=2||void 0===arguments[2]||arguments[2];classCallCheck(this,e),this[p$2.apiURL]="https://api.projectoxford.ai/vision/v1.0/ocr?"+`language=${o}&detectOrientation=${n}`,this[p$2.apiKey]=t}return e.prototype.recognize=function(e){var t=new Headers;t.append("Ocp-Apim-Subscription-Key",this[p$2.apiKey]);var o=new FormData;return o.append("image",e,"image.png"),fetch(this[p$2.apiURL],{method:"POST",headers:t,body:o}).then(function(e){return e.json()})},e.prototype.setAPIKey=function(e){this[p$2.apiKey]=e},e}(),p$4=Object.freeze({pitch:Symbol("pitch"),rate:Symbol("rate"),synthesis:Symbol("synthesis"),getPreferredVoice:Symbol("getPreferredVoice")}),SpeechSynthesizer=function(){function e(t,o){classCallCheck(this,e),this[p$4.pitch]=t,this[p$4.rate]=o,this[p$4.synthesis]=window.speechSynthesis||null,Object.seal(this)}return e.prototype.speak=function(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=arguments.length<=1||void 0===arguments[1]?"en":arguments[1],o=this[p$4.synthesis];if(e&&o){var n=new SpeechSynthesisUtterance(e),r=this[p$4.getPreferredVoice](t);r&&(n.voice=r),n.lang=t,n.pitch=this[p$4.pitch],n.rate=this[p$4.rate],o.speak(n)}},e.prototype[p$4.getPreferredVoice]=function(e){var t=this[p$4.synthesis].getVoices();if(!t.length)return null;var o=t.filter(function(t){return t.lang.startsWith(e)}),n=o.filter(function(e){return e.name.indexOf("Female")!==-1});return n.length?n[0]:o.length?o[0]:e.startsWith("en")?null:this[p$4.getPreferredVoice]("en")},e}(),LANGUAGES=new Map([["unk","Unknown"],["ar","Arabic"],["zh-Hans","Simplified Chinese"],["zh-Hant","Traditional Chinese"],["cs","Czech"],["da","Danish"],["nl","Dutch"],["en","English"],["fi","Finnish"],["fr","French"],["de","German"],["el","Greek"],["hu","Hungarian"],["it","Italian"],["ja","Japanese"],["ko","Korean"],["nb","Norwegian"],["pl","Polish"],["pt","Portuguese"],["ru","Russian"],["es","Spanish"],["sv","Swedish"],["tr","Turkish"]]),p$3=Object.freeze({synthesizer:Symbol("synthesizer")}),DEFAULT_VOICE_PITCH=.8,DEFAULT_VOICE_RATE=.9,TextReader=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?DEFAULT_VOICE_PITCH:arguments[0],o=arguments.length<=1||void 0===arguments[1]?DEFAULT_VOICE_RATE:arguments[1];classCallCheck(this,e),this[p$3.synthesizer]=new SpeechSynthesizer(t,o)}return e.prototype.read=function(e){var t=e.regions.length,o=this[p$3.synthesizer];if(0===t)return void o.speak("Sorry! I did not recognize any text.");1===t?o.speak("I see just one region of text."):o.speak(`I see ${t} regions of text.`);var n=e.language;n&&"unk"!==n?o.speak(`I think this is ${LANGUAGES.get(n)} language.`):o.speak("I can not recognize the language."),e.textAngle<5?o.speak("Text is almost perfectly aligned!"):o.speak("Text is skewed a bit");for(var r=0;r<t;r++){var i=e.regions[r];o.speak(`Region number ${r+1} consists of `+`${i.lines.length} lines of text.`);for(var a=0;a<i.lines.length;a++){var s=i.lines[a];o.speak(`Let me read words from the line number ${a+1}:`);var l=s.words.reduce(function(e,t){return`${e} ${t.text}`},"");o.speak(l,n)}}},e}(),LocalStorage=function(){function e(){classCallCheck(this,e)}return e.isSupported=function(){try{return!!self.localStorage&&Number.isInteger(self.localStorage.length)}catch(e){return!1}},e.prototype.getAll=function(e){var t=localStorage.getItem(e);return Promise.resolve(t?Array.from(new Map(JSON.parse(t)).values()):[])},e.prototype.getByKey=function(e,t){var o=localStorage.getItem(e),n=new Map(o?JSON.parse(o):[]);return n.has(t)?Promise.resolve(n.get(t)):Promise.reject(new Error(`There is no item (${t}) in the store (${e}).`))},e.prototype.set=function(e,t,o){var n=localStorage.getItem(e),r=new Map(n?JSON.parse(n):[]);return r.set(t,o),localStorage.setItem(e,JSON.stringify(Array.from(r.entries()))),Promise.resolve()},e.prototype.remove=function(e,t){var o=localStorage.getItem(e);if(o){var n=new Map(JSON.parse(o));n.delete(t),localStorage.setItem(e,JSON.stringify(Array.from(n.entries())))}return Promise.resolve()},e.prototype.clear=function(e){return localStorage.removeItem(e),Promise.resolve()},e.prototype.clearAll=function(){return localStorage.clear(),Promise.resolve()},e}(),p$5=Object.freeze({db:Symbol("db")}),InMemoryStorage=function(){function e(){classCallCheck(this,e),this[p$5.db]=new Map}return e.prototype.getAll=function(e){var t=this[p$5.db].get(e);return Promise.resolve(t?Array.from(t.values()):[])},e.prototype.getByKey=function(e,t){var o=this[p$5.db].get(e);return!o||o.has(t)?Promise.reject(new Error(`There is no item (${t}) in the store (${e}).`)):Promise.resolve(o.get(t))},e.prototype.set=function(e,t,o){var n=this[p$5.db].get(e);return n||this[p$5.db].set(e,n=new Map),n.set(t,o),Promise.resolve()},e.prototype.remove=function(e,t){var o=this[p$5.db].get(e);return o&&o.delete(t),Promise.resolve()},e.prototype.clear=function(e){var t=this[p$5.db].get(e);return t&&t.clear(),Promise.resolve()},e.prototype.clearAll=function(){return this[p$5.db].clear(),Promise.resolve()},e}(),p$6=Object.freeze({canvas:Symbol("canvas"),context:Symbol("context"),width:Symbol("width"),height:Symbol("height"),currentPoint:Symbol("currentPoint"),previousPoint:Symbol("previousPoint"),flag:Symbol("flag"),styleColor:Symbol("styleColor"),styleWidth:Symbol("styleWidth"),findXY:Symbol("findXY"),draw:Symbol("draw")}),Painter=function(){function e(t){var o=this;classCallCheck(this,e),this[p$6.canvas]=t,this[p$6.context]=t.getContext("2d"),this[p$6.width]=t.width,this[p$6.height]=t.height,this[p$6.styleColor]="#000",this[p$6.styleWidth]=2,this[p$6.currentPoint]={x:0,y:0},this[p$6.previousPoint]={x:0,y:0},this[p$6.flag]=!1,t.addEventListener("mousemove",function(e){return o[p$6.findXY]("move",e)}),t.addEventListener("mousedown",function(e){return o[p$6.findXY]("down",e)}),t.addEventListener("mouseup",function(e){return o[p$6.findXY]("up",e)}),t.addEventListener("mouseout",function(e){return o[p$6.findXY]("out",e)}),Object.seal(this)}return e.prototype.setStyle=function(e,t){if(!e)throw new Error("Color should a valid non-empty HEX color string!");if(!Number.isInteger(t)||t<0)throw Error("Width should a valid positive integer!");this[p$6.styleColor]=e,this[p$6.styleWidth]=t},e.prototype.clear=function(){this[p$6.context].clearRect(0,0,this[p$6.width],this[p$6.height])},e.prototype[p$6.findXY]=function(e,t){var o=t.offsetX,n=t.offsetY;if("down"===e){console.log(`e.offsetX: ${t.offsetX}, e.offsetY: ${t.offsetY}`),this[p$6.previousPoint]=this[p$6.currentPoint],this[p$6.currentPoint]={x:o,y:n},this[p$6.flag]=!0;var r=this[p$6.context];r.beginPath(),r.fillStyle=this[p$6.styleColor],r.fillRect(this[p$6.currentPoint].x,this[p$6.currentPoint].y,this[p$6.styleWidth],this[p$6.styleWidth]),r.closePath()}else"up"===e||"out"===e?this[p$6.flag]=!1:"move"===e&&this[p$6.flag]&&(this[p$6.previousPoint]=this[p$6.currentPoint],this[p$6.currentPoint]={x:o,y:n},this[p$6.draw]())},e.prototype[p$6.draw]=function(){var e=this[p$6.context];e.beginPath(),e.moveTo(this[p$6.previousPoint].x,this[p$6.previousPoint].y),e.lineTo(this[p$6.currentPoint].x,this[p$6.currentPoint].y),e.strokeStyle=this[p$6.styleColor],e.lineWidth=this[p$6.styleWidth],e.stroke(),e.closePath()},e}(),sampleActions=Object.freeze({RECOGNIZE:"RECOGNIZE",REPEAT:"REPEAT",ROTATE:"ROTATE"}),orientation=Object.freeze({LEFT:"Left",RIGHT:"Right",UP:"Up",DOWN:"Down"}),canPlayDefer=new Defer,videoManager=new VideoManager,textReader=new TextReader,textRecognizer=new TextRecognizer,storage=LocalStorage.isSupported()?new LocalStorage:new InMemoryStorage,samples=new Map,sampleIds=new Uint32Array(100);window.crypto.getRandomValues(sampleIds);var currentSampleIndex=0,apiKeyComponent=document.querySelector(".access__api-key");apiKeyComponent.addEventListener("change",function(){storage.set("access","api-key",apiKeyComponent.value),textRecognizer.setAPIKey(apiKeyComponent.value)}),storage.getByKey("access","api-key").catch(function(e){return console.warn("Could not retrieve API key from the storage",e),""}).then(function(e){apiKeyComponent.value=e,textRecognizer.setAPIKey(e)});var samplesListComponent=document.querySelector(".samples-list");samplesListComponent.addEventListener("click",function(e){if(!apiKeyComponent.value)return void alert("Please provide Microsoft Vision API key.");var t=e.target.dataset.sampleId;if("BUTTON"===e.target.nodeName.toUpperCase()&&t){var o=samples.get(Number.parseInt(t)),n=e.target.dataset.kind;n===sampleActions.RECOGNIZE?textRecognizer.recognize(o.image).then(function(e){console.log("Success: %o",e),o.text=e,samples.set(o.id,o),outlineSampleWords(o),textReader.read(e);var t=document.getElementById(o.id);t.classList.add("sample__container--recognized")}).catch(function(e){console.error("Failure %o",e)}):n===sampleActions.REPEAT&&textReader.read(o.text)}});var videoPreviewComponent=document.querySelector(".video__preview"),blobRendererComponent=document.querySelector(".blob__renderer"),blobLoaderComponent=document.querySelector(".blob__loader"),context=blobRendererComponent.getContext("2d");context.fillStyle="#aaa",context.fillRect(0,0,blobRendererComponent.width,blobRendererComponent.height),videoManager.getMediaStream().then(function(e){videoPreviewComponent.src=window.URL.createObjectURL(e),videoPreviewComponent.addEventListener("loadedmetadata",function(){videoPreviewComponent.play();var e=320,t=videoPreviewComponent.videoHeight/(videoPreviewComponent.videoWidth/e);isNaN(t)&&(t=e/(4/3)),videoPreviewComponent.setAttribute("width",e),videoPreviewComponent.setAttribute("height",t),canPlayDefer.resolve({width:e,height:t})},!1)}).catch(function(e){canPlayDefer.reject(e)});var shotButton=document.querySelector(".video__shot-button");shotButton.setAttribute("disabled","disabled"),shotButton.addEventListener("click",function(){var e=videoPreviewComponent.getAttribute("width"),t=videoPreviewComponent.getAttribute("height");blobRendererComponent.setAttribute("width",e),blobRendererComponent.setAttribute("height",t),blobRendererComponent.getContext("2d").drawImage(videoPreviewComponent,0,0,Number(e),Number(t)),blobRendererComponent.toBlob(function(e){addSample(e)})}),canPlayDefer.promise.then(function(){shotButton.removeAttribute("disabled")});var urlProviderURL=document.querySelector(".sample-url-provider__url"),urlProviderSubmit=document.querySelector(".sample-url-provider__submit");urlProviderSubmit.addEventListener("click",function(){var e=urlProviderURL.value;return e?void addSampleFromURL(e):void alert("Please provide a valid image URL!")});var localFileProviderPath=document.querySelector(".local-file-provider__path"),localFileProviderUpload=document.querySelector(".local-file-provider__upload");localFileProviderPath.addEventListener("change",function(e){for(var t of e.target.files)addSample(t)}),localFileProviderUpload.addEventListener("click",function(){localFileProviderPath.click()});var manualSampleCanvas=document.querySelector(".manual-sample-provider__canvas"),manualSampleColorPicker=document.querySelector(".manual-sample-provider__color-picker"),manualSampleWidth=document.querySelector(".manual-sample-provider__width"),manualSampleClearButton=document.querySelector(".manual-sample-provider__clear-button"),manualSampleSubmit=document.querySelector(".manual-sample-provider__submit"),painter=new Painter(manualSampleCanvas);manualSampleColorPicker.addEventListener("change",function(){painter.setStyle(manualSampleColorPicker.value,Number(manualSampleWidth.value))}),manualSampleWidth.addEventListener("change",function(){painter.setStyle(manualSampleColorPicker.value,Number(manualSampleWidth.value))}),manualSampleClearButton.addEventListener("click",function(){painter.clear()}),manualSampleSubmit.addEventListener("click",function(){manualSampleCanvas.toBlob(function(e){return addSample(e)})}),window.addEventListener("hashchange",function(){addSampleFromHash()}),addSampleFromHash();

//# sourceMappingURL=app.js.map
